<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Home Security - Arm/Disarm</title>
  <link rel="stylesheet" href="../css/bootstrap.css" />
  <link rel="stylesheet" href="../css/main.css" />
  <link rel="icon" type="image/x-icon" href="../img/icon.svg" />
  <script src="https://cdn.jsdelivr.net/npm/mqtt/dist/mqtt.min.js"></script>
  <script>
    const client = mqtt.connect('wss://test.mosquitto.org:8081');
  </script>
  <script src="../javascript/toggleAlarm.js"></script> 
  <script src="../javascript/batteryNotification.js" type="module"></script>
  <script src="../javascript/allowNotifications.js"></script> 
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    async function sendEmail(to, subject, text) {
      try {
        const response = await fetch('http://localhost:3000/send-email', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ to, subject, text }),
        });

        const data = await response.json();
        if (data.success) {
          console.log('‚úÖ Email sent:', data.message);
        } else {
          console.error('‚ùå Failed to send email:', data.message);
        }
      } catch (err) {
        console.error('‚ùå Error:', err);
      }
    }

    // Example usage (you can call this on an event)
    // sendEmail('filqwerty987@gmail.com', 'Test Subject', 'Test email content');
  </script>
</head>

<body>
  <div id="batteryAlert" class="alert-container">
    <div class="custom-alert">
      <span class="alert-text">üîã <strong>Battery is low!</strong> Please check the power supply.</span>
      <button class="dismiss-btn" onclick="dismissBatteryAlert()">√ó</button>
    </div>
  </div>    
  
  <div class="card text-center" id="mainCard">
    <h3 class="mb-4" id="systemTitle">Home Security System</h3>
    <p class="status-indicator text-success" id="systemStatus">Status: Disarmed</p>
    <div id="armedIndicator" class="status-light mt-4"></div>
    <div class="d-grid gap-2 mt-4" id="controlButtons">
      <button class="btn btn-success" id="armButton" onclick="sendEmail('filqwerty987@gmail.com', 'System Armed', 'Your home security system has been armed.')">Arm</button>
    </div>
  </div>
</body>
</html>
